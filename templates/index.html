{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/maze.css' %}">
    <link rel="stylesheet" href="{% static 'css/start-menu.css' %}">
    <title>Next Star - Gaming Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --parrot-primary: #1a1a2e;
            --parrot-secondary: #16213e;
            --parrot-accent: #00ff88;
            --parrot-accent-secondary: #0099ff;
            --parrot-text: #ffffff;
            --parrot-text-secondary: #888;
            --parrot-border: #2a2a4a;
            --parrot-hover: #2a2a4a;
            --parrot-window-bg: rgba(26, 26, 46, 0.95);
            --parror-terminal-bg: #0c0c0c;
        }

        body {
            background: linear-gradient(135deg, var(--parrot-primary) 0%, var(--parrot-secondary) 100%);
            color: var(--parrot-text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Three.js Canvas */
        #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Top Bar - Parrot OS Style */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--parrot-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            color: var(--parrot-accent);
        }

        .system-tray {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .system-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .system-icon:hover {
            color: var(--parrot-accent);
        }

        /* Dock - Parrot OS Style */
        .dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid var(--parrot-border);
            border-radius: 15px;
            padding: 10px 20px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .dock-item {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .dock-item:hover {
            background: var(--parrot-accent);
            transform: translateY(-5px) scale(1.1);
            color: #000;
        }

        .dock-item.active {
            background: var(--parrot-accent);
            color: #000;
        }

        /* Windows */
        .window {
            position: absolute;
            background: var(--parrot-window-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--parrot-border);
            border-radius: 10px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            min-width: 400px;
            min-height: 300px;
            display: none;
            flex-direction: column;
            z-index: 100;
        }

        .window.maximized {
            position: fixed;
            top: 40px;
            left: 0;
            right: 0;
            bottom: 0;
            width: auto;
            height: auto;
            border-radius: 0;
        }

        .window-header {
            height: 40px;
            background: rgba(26, 26, 46, 0.8);
            border-bottom: 1px solid var(--parrot-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            cursor: move;
            border-radius: 10px 10px 0 0;
        }

        .window-title {
            font-weight: 600;
            color: var(--parrot-accent);
        }

        .window-controls {
            display: flex;
            gap: 10px;
        }

        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .window-control.close { background: #ff5f57; }
        .window-control.minimize { background: #ffbd2e; }
        .window-control.maximize { background: #28ca42; }

        .window-content {
            flex: 1;
            padding: 20px;
            overflow: auto;
        }

        /* Specific Window Styles */
        #ventureWindow {
            top: 100px;
            left: 50px;
            width: 800px;
            height: 600px;
        }

        #portfolioWindow {
            top: 150px;
            left: 200px;
            width: 700px;
            height: 500px;
        }

        #profileWindow {
            top: 120px;
            right: 50px;
            width: 500px;
            height: 550px;
        }

        #leaderboardWindow {
            top: 180px;
            right: 150px;
            width: 600px;
            height: 450px;
        }

        /* Venture Grid */
        .venture-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .venture-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--parrot-border);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .venture-card:hover {
            border-color: var(--parrot-accent);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 255, 136, 0.2);
        }

        .venture-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .venture-icon {
            font-size: 2rem;
        }

        .venture-info h3 {
            color: var(--parrot-accent);
            margin-bottom: 5px;
        }

        .venture-stats {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            color: var(--parrot-text-secondary);
        }

        .venture-description {
            color: var(--parrot-text-secondary);
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .join-btn {
            width: 100%;
            padding: 10px;
            background: var(--parrot-accent);
            border: none;
            border-radius: 5px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .join-btn:hover:not(:disabled) {
            background: var(--parrot-accent-secondary);
            transform: translateY(-2px);
        }

        .join-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Portfolio Grid */
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .portfolio-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--parrot-border);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .portfolio-icon {
            font-size: 1.5rem;
        }

        .portfolio-details h4 {
            color: var(--parrot-accent);
            margin-bottom: 5px;
        }

        /* Profile Content */
        .profile-content {
            padding: 20px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            font-size: 3rem;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-info h2 {
            color: var(--parrot-accent);
            margin-bottom: 5px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--parrot-border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--parrot-accent);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--parrot-text-secondary);
        }

        /* XP Progress Bar */
        .xp-progress {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .xp-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--parrot-accent), var(--parrot-accent-secondary));
            transition: width 0.3s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dock {
                bottom: 10px;
                padding: 8px 15px;
            }

            .dock-item {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .window {
                min-width: 300px;
                min-height: 400px;
            }

            #ventureWindow,
            #portfolioWindow,
            #profileWindow,
            #leaderboardWindow {
                top: 50px !important;
                left: 10px !important;
                right: 10px !important;
                width: auto !important;
                height: auto !important;
            }

            .venture-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
            }

            .portfolio-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 15px;
            }

            .profile-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .top-bar {
                padding: 0 10px;
            }

            .logo span {
                display: none;
            }

            .system-tray {
                gap: 10px;
            }

            .dock {
                gap: 8px;
                padding: 5px 10px;
            }

            .dock-item {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }

            .window-header {
                padding: 0 10px;
            }

            .window-content {
                padding: 15px;
            }
        }

        /* Terminal-like elements */
        .terminal-window {
            background: var(--parror-terminal-bg);
            border: 1px solid var(--parrot-accent);
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            color: var(--parrot-accent);
        }

        .terminal-prompt {
            color: var(--parrot-accent-secondary);
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 50px;
            right: 20px;
            background: var(--parrot-accent);
            color: #000;
            padding: 15px 25px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Loading Screen */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--parrot-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top: 3px solid var(--parrot-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-spinner"></div>
        <div>Loading Next Star...</div>
    </div>

    <!-- Three.js Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="logo">
            <span>🦜 NEXT STAR</span>
        </div>
        <div class="system-tray">
            <div class="system-icon" id="authHudBtn" onclick="openAuthOrProfile()">👤</div>
            <div class="system-icon" id="ticketCount">🎫 5</div>
            <div class="system-icon" id="equityPercent">📈 0%</div>
            <div class="system-icon" id="ventureCount">⚔️ 0</div>
        </div>
    </div>

    <!-- Dock -->
    <div class="dock">
        <div class="dock-item active" onclick="openWindow('ventureWindow')" title="Ventures">
            ⚔️
        </div>
        <div class="dock-item" onclick="openWindow('portfolioWindow')" title="Portfolio">
            📊
        </div>
        <div class="dock-item" onclick="openWindow('profileWindow')" title="Profile">
            👤
        </div>
        <div class="dock-item" onclick="openWindow('shopWindow')" title="Shop">
            🛒
        </div>
        <div class="dock-item" onclick="openWindow('settingsWindow')" title="Settings">
            ⚙️
        </div>
    </div>



    <!-- Start Menu -->
    <div class="start-menu" id="startMenu">
        <div class="start-menu-header">
            <div class="user-info">
                <div class="user-avatar" id="startMenuAvatar">🚀</div>
                <div class="user-details">
                    <div class="user-name" id="startMenuName">Guest Player</div>
                    <div class="user-level">Level <span id="startMenuLevel">1</span></div>
                </div>
            </div>
            <div class="quick-stats">
                <div class="quick-stat">
                    <span class="stat-icon">🎫</span>
                    <span class="stat-value" id="startMenuTickets">5</span>
                </div>
                <div class="quick-stat">
                    <span class="stat-icon">⭐</span>
                    <span class="stat-value" id="startMenuStars">100</span>
                </div>
                <div class="quick-stat">
                    <span class="stat-icon">📈</span>
                    <span class="stat-value" id="startMenuEquity">0%</span>
                </div>
            </div>
        </div>

        <div class="start-menu-content">
            <!-- Search Bar -->
            <div class="search-section">
                <div class="search-container">
                    <input type="text" id="startMenuSearch" placeholder="Search ventures, players, features..." class="search-input">
                    <div class="search-icon">🔍</div>
                </div>
            </div>

            <!-- Quick Actions Grid -->
            <div class="quick-actions-grid">
                <div class="quick-action" onclick="openWindow('profileWindow'); hideStartMenu();">
                    <div class="action-icon">👤</div>
                    <div class="action-label">Profile</div>
                </div>
                <div class="quick-action" onclick="openWindow('ventureWindow'); hideStartMenu();">
                    <div class="action-icon">⚔️</div>
                    <div class="action-label">Ventures</div>
                </div>
                <div class="quick-action" onclick="openWindow('portfolioWindow'); hideStartMenu();">
                    <div class="action-icon">📊</div>
                    <div class="action-label">Portfolio</div>
                </div>
                <div class="quick-action" onclick="openWindow('eternalMazeWindow'); setTimeout(() => mazeEngine.init(), 100); hideStartMenu();">
                    <div class="action-icon">🌌</div>
                    <div class="action-label">Eternal Maze</div>
                </div>
                <div class="quick-action" onclick="openWindow('walletWindow'); hideStartMenu();">
                    <div class="action-icon">💰</div>
                    <div class="action-label">Wallet</div>
                </div>
                <div class="quick-action" onclick="openWindow('nftWindow'); hideStartMenu();">
                    <div class="action-icon">🖼️</div>
                    <div class="action-label">NFT Tickets</div>
                </div>
                <div class="quick-action" onclick="openWindow('sharesWindow'); hideStartMenu();">
                    <div class="action-icon">📈</div>
                    <div class="action-label">Shares</div>
                </div>
                <div class="quick-action" onclick="openWindow('leaderboardWindow'); hideStartMenu();">
                    <div class="action-icon">🏆</div>
                    <div class="action-label">Leaderboard</div>
                </div>
                <div class="quick-action" onclick="openWindow('shopWindow'); hideStartMenu();">
                    <div class="action-icon">🛒</div>
                    <div class="action-label">Shop</div>
                </div>
                <div class="quick-action" onclick="openWindow('settingsWindow'); hideStartMenu();">
                    <div class="action-icon">⚙️</div>
                    <div class="action-label">Settings</div>
                </div>
                <div class="quick-action" onclick="openWindow('faqWindow'); hideStartMenu();">
                    <div class="action-icon">❓</div>
                    <div class="action-label">FAQ & Help</div>
                </div>
                <div class="quick-action" onclick="showNotifications(); hideStartMenu();">
                    <div class="action-icon">🔔</div>
                    <div class="action-label">Notifications</div>
                    <div class="notification-badge" id="notificationCount">3</div>
                </div>
            </div>

            <!-- Recent Ventures -->
            <div class="recent-section">
                <h3 class="section-title">Recent Ventures</h3>
                <div class="recent-list" id="recentVenturesList">
                    <!-- Recent ventures will be populated here -->
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="stats-section">
                <h3 class="section-title">Quick Stats</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="quickVenturesJoined">0</div>
                        <div class="stat-label">Ventures Joined</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="quickTotalEquity">0%</div>
                        <div class="stat-label">Total Equity</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="quickBadgesEarned">0</div>
                        <div class="stat-label">Badges Earned</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="quickDaysActive">1</div>
                        <div class="stat-label">Days Active</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="start-menu-footer">
            <button class="logout-btn" onclick="handleLogout(); hideStartMenu();">🚪 Logout</button>
            <div class="footer-info">
                <span>Next Star v1.0</span>
                <span>•</span>
                <span id="currentTime">00:00</span>
            </div>
        </div>
    </div>

    <!-- Start Menu Trigger -->
    <div class="start-menu-trigger" onclick="toggleStartMenu()">
        <div class="start-icon">⭐</div>
    </div>



    <!-- Windows -->
    <div class="window" id="ventureWindow">
        <div class="window-header">
            <div class="window-title">Venture Marketplace</div>
            <div class="window-controls">
                <div class="window-control minimize" onclick="minimizeWindow('ventureWindow')"></div>
                <div class="window-control maximize" onclick="toggleMaximize('ventureWindow')"></div>
                <div class="window-control close" onclick="closeWindow('ventureWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div class="venture-grid" id="ventureGrid">
                <!-- Ventures will be loaded here by JavaScript -->
            </div>
        </div>
    </div>

    <div class="window" id="portfolioWindow">
        <div class="window-header">
            <div class="window-title">My Portfolio</div>
            <div class="window-controls">
                <div class="window-control minimize" onclick="minimizeWindow('portfolioWindow')"></div>
                <div class="window-control maximize" onclick="toggleMaximize('portfolioWindow')"></div>
                <div class="window-control close" onclick="closeWindow('portfolioWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div class="portfolio-grid" id="portfolioGrid">
                <!-- Portfolio items will be loaded here -->
            </div>
        </div>
    </div>

    <div class="window" id="profileWindow">
        <div class="window-header">
            <div class="window-title">Player Profile</div>
            <div class="window-controls">
                <div class="window-control minimize" onclick="minimizeWindow('profileWindow')"></div>
                <div class="window-control maximize" onclick="toggleMaximize('profileWindow')"></div>
                <div class="window-control close" onclick="closeWindow('profileWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div class="profile-content">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">🚀</div>
                    <div class="profile-info">
                        <h2 id="profileName">Guest Player</h2>
                        <div>Level <span id="profileLevel">1</span></div>
                    </div>
                </div>
                
                <div class="xp-progress">
                    <div class="xp-progress-bar" id="xpProgress" style="width: 0%"></div>
                </div>
                <div id="xpText" style="text-align: center; margin-bottom: 20px;">0/100 XP</div>
                
                <div class="profile-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="profileTickets">5</div>
                        <div class="stat-label">Tickets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileVentures">0</div>
                        <div class="stat-label">Ventures</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileEquity">0%</div>
                        <div class="stat-label">Total Equity</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileBadges">0</div>
                        <div class="stat-label">Badges</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="color: var(--parrot-accent); margin-bottom: 15px;">Recent Activity</h3>
                    <div id="activityList">
                        <!-- Activity will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="window" id="leaderboardWindow">
        <div class="window-header">
            <div class="window-title">Leaderboard</div>
            <div class="window-controls">
                <div class="window-control minimize" onclick="minimizeWindow('leaderboardWindow')"></div>
                <div class="window-control maximize" onclick="toggleMaximize('leaderboardWindow')"></div>
                <div class="window-control close" onclick="closeWindow('leaderboardWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div style="padding: 20px; text-align: center;">
                <div class="terminal-window">
                    <div class="terminal-prompt">$ loading leaderboard...</div>
                    <div>Coming Soon!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shop and Settings Windows (simplified) -->
    <div class="window" id="shopWindow">
        <div class="window-header">
            <div class="window-title">Star Shop</div>
            <div class="window-controls">
                <div class="window-control close" onclick="closeWindow('shopWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div style="padding: 20px; text-align: center;">
                <h3 style="color: var(--parrot-accent); margin-bottom: 20px;">Purchase Star Tickets</h3>
                <button class="join-btn" onclick="gameEngine.buyTickets(5)" style="margin-bottom: 10px;">
                    Buy 5 Tickets - 100 Stars
                </button>
                <button class="join-btn" onclick="gameEngine.buyTickets(10)">
                    Buy 10 Tickets - 180 Stars
                </button>
            </div>
        </div>
    </div>

    <div class="window" id="settingsWindow">
        <div class="window-header">
            <div class="window-title">Settings</div>
            <div class="window-controls">
                <div class="window-control close" onclick="closeWindow('settingsWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div style="padding: 20px;">
                <h3 style="color: var(--parrot-accent); margin-bottom: 20px;">Game Settings</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;">Theme:</label>
                    <select style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid var(--parrot-border); color: white; border-radius: 5px;">
                        <option>Dark Theme</option>
                        <option>Light Theme</option>
                        <option>Nebula Theme</option>
                    </select>
                </div>
                <!-- Add more settings as needed -->
            </div>
        </div>
    </div>

    <!-- Eternal Maze Window -->
    <div class="window" id="eternalMazeWindow">
        <div class="window-header">
            <div class="window-title">🌌 Eternal Maze - The Matrix</div>
            <div class="window-controls">
                <div class="window-control minimize" onclick="minimizeWindow('eternalMazeWindow')"></div>
                <div class="window-control maximize" onclick="toggleMaximize('eternalMazeWindow'); mazeEngine.handleResize();"></div>
                <div class="window-control close" onclick="closeWindow('eternalMazeWindow')"></div>
            </div>
        </div>
        <div class="window-content" style="padding: 0; position: relative; overflow: hidden;">
            <!-- Stats Panel - Top Left -->
            <div class="maze-panel stats-panel">
                <div class="panel-title">Maze Status</div>
                <div class="stat-row">
                    <span class="stat-label">Level:</span>
                    <span class="stat-value" id="mazeLevel">1</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Moves:</span>
                    <span class="stat-value" id="mazeMoves">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Time:</span>
                    <span class="stat-value" id="mazeTime">00:00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Patterns:</span>
                    <span class="stat-value" id="patternsFound">0/7</span>
                </div>
            </div>

            <!-- Controls Panel - Top Right -->
            <div class="maze-panel controls-panel">
                <div class="panel-title">Controls</div>
                <button onclick="mazeEngine.resetMaze()" class="maze-btn">Reset Maze</button>
                <button onclick="mazeEngine.showHint()" class="maze-btn">Hint (5⭐)</button>
                <button onclick="mazeEngine.activateStrategyMode()" class="maze-btn strategy-btn">Strategy Mode</button>
            </div>

            <!-- Strategy Panel - Bottom Left (Initially Hidden) -->
            <div class="maze-panel strategy-panel" id="strategyPanel" style="display: none;">
                <div class="panel-title">Strategic Analysis</div>
                <div class="strategy-section">
                    <div class="section-label">Pattern Sequence:</div>
                    <div class="sequence-display" id="patternSequence">None</div>
                </div>
                <div class="strategy-section">
                    <div class="section-label">Available Patterns:</div>
                    <div class="patterns-display" id="availablePatterns">None collected</div>
                </div>
                <button onclick="mazeEngine.executeStrategicMove()" class="maze-btn execute-btn">Execute Strategic Move</button>
            </div>

            <!-- Instructions Panel - Bottom Right -->
            <div class="maze-panel instructions-panel">
                <div class="panel-title">Instructions</div>
                <div class="instruction-text">
                    <strong>Arrow Keys:</strong> Move through maze<br>
                    <strong>Find 7 Patterns:</strong> Hidden throughout maze<br>
                    <strong>Strategy Mode:</strong> Unlocks with patterns<br>
                    <strong>Goal:</strong> Reach the exit using strategy
                </div>
            </div>

            <!-- Maze Canvas - Takes remaining space -->
            <div class="maze-container">
                <canvas id="mazeCanvas"></canvas>
            </div>

            <!-- Message Modal -->
            <div class="maze-modal" id="mazeMessage" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modalTitle">Message</h3>
                        <span class="modal-close" onclick="mazeEngine.hideMessage()">×</span>
                    </div>
                    <div class="modal-body" id="messageContent"></div>
                    <div class="modal-footer">
                        <button onclick="mazeEngine.hideMessage()" class="maze-btn">Continue</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Wallet Window -->
    <div class="window" id="walletWindow">
        <div class="window-header">
            <div class="window-title">💰 Digital Wallet</div>
            <div class="window-controls">
                <div class="window-control close" onclick="closeWindow('walletWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div class="wallet-content">
                <div class="balance-cards">
                    <div class="balance-card">
                        <div class="balance-icon">⭐</div>
                        <div class="balance-info">
                            <div class="balance-label">Star Tokens</div>
                            <div class="balance-amount" id="walletStars">100</div>
                        </div>
                    </div>
                    <div class="balance-card">
                        <div class="balance-icon">🎫</div>
                        <div class="balance-info">
                            <div class="balance-label">Venture Tickets</div>
                            <div class="balance-amount" id="walletTickets">5</div>
                        </div>
                    </div>
                    <div class="balance-card">
                        <div class="balance-icon">💰</div>
                        <div class="balance-info">
                            <div class="balance-label">Game Coins</div>
                            <div class="balance-amount" id="walletCoins">1,000</div>
                        </div>
                    </div>
                </div>

                <div class="transaction-history">
                    <h3>Recent Transactions</h3>
                    <div class="transaction-list" id="transactionList">
                        <div class="transaction-item">
                            <div class="transaction-icon">🛒</div>
                            <div class="transaction-details">
                                <div class="transaction-title">Ticket Purchase</div>
                                <div class="transaction-date">Just now</div>
                            </div>
                            <div class="transaction-amount">-5 ⭐</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NFT Tickets Window -->
    <div class="window" id="nftWindow">
        <div class="window-header">
            <div class="window-title">🖼️ NFT Tickets Collection</div>
            <div class="window-controls">
                <div class="window-control close" onclick="closeWindow('nftWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div class="nft-content">
                <div class="nft-stats">
                    <div class="nft-stat">
                        <div class="nft-stat-value" id="nftTotal">3</div>
                        <div class="nft-stat-label">Total NFTs</div>
                    </div>
                    <div class="nft-stat">
                        <div class="nft-stat-value" id="nftRare">1</div>
                        <div class="nft-stat-label">Rare</div>
                    </div>
                    <div class="nft-stat">
                        <div class="nft-stat-value" id="nftEpic">0</div>
                        <div class="nft-stat-label">Epic</div>
                    </div>
                </div>

                <div class="nft-grid">
                    <div class="nft-card">
                        <div class="nft-image">🎫</div>
                        <div class="nft-info">
                            <div class="nft-name">Starter Ticket</div>
                            <div class="nft-rarity common">Common</div>
                        </div>
                    </div>
                    <div class="nft-card">
                        <div class="nft-image">⚡</div>
                        <div class="nft-info">
                            <div class="nft-name">Energy Venture Pass</div>
                            <div class="nft-rarity rare">Rare</div>
                        </div>
                    </div>
                    <div class="nft-card">
                        <div class="nft-image">🌱</div>
                        <div class="nft-info">
                            <div class="nft-name">Quantum Farms Access</div>
                            <div class="nft-rarity common">Common</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shares Window -->
    <div class="window" id="sharesWindow">
        <div class="window-header">
            <div class="window-title">📈 Equity Shares</div>
            <div class="window-controls">
                <div class="window-control close" onclick="closeWindow('sharesWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div class="shares-content">
                <div class="shares-summary">
                    <div class="total-equity">
                        <div class="equity-label">Total Portfolio Value</div>
                        <div class="equity-value">$<span id="totalPortfolioValue">12,450</span></div>
                    </div>
                    <div class="equity-breakdown">
                        <div class="breakdown-item">
                            <span class="breakdown-label">Venture Equity:</span>
                            <span class="breakdown-value" id="ventureEquityValue">$10,200</span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-label">NFT Value:</span>
                            <span class="breakdown-value" id="nftEquityValue">$2,250</span>
                        </div>
                    </div>
                </div>

                <div class="shares-list">
                    <h3>Your Venture Shares</h3>
                    <div class="shares-grid" id="sharesGrid">
                        <!-- Shares will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FAQ Window -->
    <div class="window" id="faqWindow">
        <div class="window-header">
            <div class="window-title">❓ FAQ & Help Center</div>
            <div class="window-controls">
                <div class="window-control close" onclick="closeWindow('faqWindow')"></div>
            </div>
        </div>
        <div class="window-content">
            <div class="faq-content">
                <div class="faq-search">
                    <input type="text" placeholder="Search help topics..." class="search-input">
                </div>

                <div class="faq-categories">
                    <div class="faq-category active" data-category="getting-started">Getting Started</div>
                    <div class="faq-category" data-category="ventures">Ventures</div>
                    <div class="faq-category" data-category="nft">NFT Tickets</div>
                    <div class="faq-category" data-category="maze">Eternal Maze</div>
                </div>

                <div class="faq-questions">
                    <div class="faq-item">
                        <div class="faq-question">How do I join a venture?</div>
                        <div class="faq-answer">Use venture tickets to join available ventures. Each venture requires 1 ticket and gives you equity share.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">What are NFT tickets?</div>
                        <div class="faq-answer">NFT tickets are special access passes that grant exclusive benefits and can be traded.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">How does the Eternal Maze work?</div>
                        <div class="faq-answer">The maze requires strategic thinking and pattern recognition. Collect patterns and use Strategy Mode to escape.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="{% static 'js/game-engine.js' %}"></script>
    <script src="{% static 'js/maze-engine.js' %}"></script>
    <script src="{% static 'js/start-menu.js' %}"></script>
    
    <script>
        // Window Management
        let activeWindow = null;
        let zIndex = 100;

        function openWindow(windowId) {
            const window = document.getElementById(windowId);
            if (window) {
                // Close current active window if it's the same
                if (activeWindow === windowId) {
                    closeWindow(windowId);
                    return;
                }
                
                // Bring to front
                zIndex++;
                window.style.zIndex = zIndex;
                window.style.display = 'flex';
                activeWindow = windowId;
                
                // Update dock active state
                document.querySelectorAll('.dock-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.classList.add('active');
            }
        }

        function closeWindow(windowId) {
            const window = document.getElementById(windowId);
            if (window) {
                window.style.display = 'none';
                if (activeWindow === windowId) {
                    activeWindow = null;
                }
            }
        }

        function minimizeWindow(windowId) {
            const window = document.getElementById(windowId);
            if (window) {
                window.style.display = 'none';
            }
        }

        function toggleMaximize(windowId) {
            const window = document.getElementById(windowId);
            if (window) {
                window.classList.toggle('maximized');
            }
        }

        // Make windows draggable
        function makeDraggable(windowId) {
            const window = document.getElementById(windowId);
            const header = window.querySelector('.window-header');
            
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            header.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // get the mouse cursor position at startup:
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // call a function whenever the cursor moves:
                document.onmousemove = elementDrag;
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // calculate the new cursor position:
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // set the element's new position:
                window.style.top = (window.offsetTop - pos2) + "px";
                window.style.left = (window.offsetLeft - pos1) + "px";
            }
            
            function closeDragElement() {
                // stop moving when mouse button is released:
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // Initialize draggable windows
        document.addEventListener('DOMContentLoaded', function() {
            const windows = document.querySelectorAll('.window');
            windows.forEach(window => {
                makeDraggable(window.id);
            });
        });

        // Three.js Animation
        function initThreeJS() {
            const canvas = document.getElementById('gameCanvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            
            // Create particles
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 5000;
            
            const posArray = new Float32Array(particlesCount * 3);
            
            for(let i = 0; i < particlesCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 100;
            }
            
            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            
            // Material
            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.02,
                color: 0x00ff88,
                transparent: true,
                opacity: 0.8
            });
            
            // Points mesh
            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(particlesMesh);
            
            camera.position.z = 2;
            
            // Mouse movement effect
            let mouseX = 0;
            let mouseY = 0;
            
            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
            });
            
            // Animation
            function animate() {
                requestAnimationFrame(animate);
                
                particlesMesh.rotation.x += 0.001;
                particlesMesh.rotation.y += 0.001;
                
                // Mouse interaction
                particlesMesh.rotation.x += mouseY * 0.0001;
                particlesMesh.rotation.y += mouseX * 0.0001;
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Handle resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.getElementById('notificationContainer').appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Global auth function
        function openAuthOrProfile() {
            if (authManager.currentUser.isGuest) {
                window.location.href = 'login.html';
            } else {
                authManager.loadProfileData();
                openWindow('profileWindow');
            }
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 2000);
            
            // Initialize Three.js
            initThreeJS();
            
            // Initialize game engine
            if (typeof gameEngine !== 'undefined') {
                gameEngine.init();
            }
            
            // Initialize auth manager
            if (typeof authManager !== 'undefined') {
                authManager.init();
            }
            
            // Open ventures window by default
            setTimeout(() => {
                openWindow('ventureWindow');
            }, 500);
        });

        // Export functions to global scope
        window.openWindow = openWindow;
        window.closeWindow = closeWindow;
        window.minimizeWindow = minimizeWindow;
        window.toggleMaximize = toggleMaximize;
        window.showNotification = showNotification;
        window.openAuthOrProfile = openAuthOrProfile;
    </script>
</body>
</html>